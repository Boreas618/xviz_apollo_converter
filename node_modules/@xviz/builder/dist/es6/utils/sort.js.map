{"version":3,"file":"sort.js","names":["insertTimestamp","timestamps","values","ts","key","value","targetIndex","findIndex","x","Math","abs","Number","EPSILON","primitives","push","insertIndex","length","splice"],"sources":["../../../src/utils/sort.js"],"sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * Find existing timestamp or insert a new one. The 'values' arrays is a parallel index\n * where the primitives will be added.\n *\n * Primitives will be merged by 'key'\n * @param timestamps list of sorted timestamps\n * @param values list of values sorted based on timestamps\n * @param ts\n * @param value\n */\nexport function insertTimestamp(timestamps, values, ts, key, value) {\n  // Find number that equals the timestamp\n  const targetIndex = timestamps.findIndex(x => Math.abs(x - ts) < Number.EPSILON);\n  if (targetIndex !== -1) {\n    // Add to existing entry\n    const primitives = values[targetIndex];\n    if (!primitives[key]) {\n      primitives[key] = [];\n    }\n\n    primitives[key].push(value);\n  } else {\n    // Insert new entry\n    let insertIndex = timestamps.findIndex(x => x > ts);\n    if (insertIndex === -1) {\n      insertIndex = timestamps.length;\n    }\n\n    timestamps.splice(insertIndex, 0, ts);\n    const primitives = {\n      [key]: [value]\n    };\n    values.splice(insertIndex, 0, primitives);\n  }\n}\n"],"mappings":"AAwBA,OAAO,SAASA,eAAT,CAAyBC,UAAzB,EAAqCC,MAArC,EAA6CC,EAA7C,EAAiDC,GAAjD,EAAsDC,KAAtD,EAA6D;EAElE,MAAMC,WAAW,GAAGL,UAAU,CAACM,SAAX,CAAqBC,CAAC,IAAIC,IAAI,CAACC,GAAL,CAASF,CAAC,GAAGL,EAAb,IAAmBQ,MAAM,CAACC,OAApD,CAApB;;EACA,IAAIN,WAAW,KAAK,CAAC,CAArB,EAAwB;IAEtB,MAAMO,UAAU,GAAGX,MAAM,CAACI,WAAD,CAAzB;;IACA,IAAI,CAACO,UAAU,CAACT,GAAD,CAAf,EAAsB;MACpBS,UAAU,CAACT,GAAD,CAAV,GAAkB,EAAlB;IACD;;IAEDS,UAAU,CAACT,GAAD,CAAV,CAAgBU,IAAhB,CAAqBT,KAArB;EACD,CARD,MAQO;IAEL,IAAIU,WAAW,GAAGd,UAAU,CAACM,SAAX,CAAqBC,CAAC,IAAIA,CAAC,GAAGL,EAA9B,CAAlB;;IACA,IAAIY,WAAW,KAAK,CAAC,CAArB,EAAwB;MACtBA,WAAW,GAAGd,UAAU,CAACe,MAAzB;IACD;;IAEDf,UAAU,CAACgB,MAAX,CAAkBF,WAAlB,EAA+B,CAA/B,EAAkCZ,EAAlC;IACA,MAAMU,UAAU,GAAG;MACjB,CAACT,GAAD,GAAO,CAACC,KAAD;IADU,CAAnB;IAGAH,MAAM,CAACe,MAAP,CAAcF,WAAd,EAA2B,CAA3B,EAA8BF,UAA9B;EACD;AACF"}