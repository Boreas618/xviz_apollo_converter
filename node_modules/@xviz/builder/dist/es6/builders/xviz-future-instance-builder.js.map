{"version":3,"file":"xviz-future-instance-builder.js","names":["XVIZPrimitiveBuilder","insertTimestamp","CATEGORY","XVIZFutureInstanceBuilder","constructor","props","category","FUTURE_INSTANCE","reset","_futures","_timestamp","timestamp","_ts","_flush","future","_streamId","timestamps","primitives","primitive","_formatPrimitive","update","_type","getData","Object","keys","length"],"sources":["../../../src/builders/xviz-future-instance-builder.js"],"sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/* eslint-disable camelcase */\nimport XVIZPrimitiveBuilder from './xviz-primitive-builder';\nimport {insertTimestamp} from '../utils';\nimport {CATEGORY} from './constant';\n\nexport default class XVIZFutureInstanceBuilder extends XVIZPrimitiveBuilder {\n  constructor(props) {\n    super({\n      ...props,\n      category: CATEGORY.FUTURE_INSTANCE\n    });\n\n    this.reset();\n    // futures: {[streamId]: {...,timestamps: [], primitives: []}}\n    this._futures = {};\n  }\n\n  _timestamp(timestamp) {\n    this._ts = timestamp;\n    return this;\n  }\n\n  _flush() {\n    let future = this._futures[this._streamId];\n    if (!future) {\n      future = {\n        timestamps: [],\n        primitives: []\n      };\n      this._futures[this._streamId] = future;\n    }\n\n    const primitive = this._formatPrimitive();\n\n    const {timestamps, primitives} = future;\n\n    // Each type like \"image\" has an \"images\" array, this hack saves a\n    // big switch statement.\n    const update = {};\n    update[`${this._type}s`] = [primitive];\n\n    // insert ts and primitive to the position based on timestamp order\n    insertTimestamp(timestamps, primitives, this._ts, `${this._type}s`, primitive);\n\n    this.reset();\n  }\n\n  getData() {\n    if (this._type) {\n      this._flush();\n    }\n\n    if (Object.keys(this._futures).length === 0) {\n      return null;\n    }\n\n    return this._futures;\n  }\n\n  reset() {\n    super.reset();\n  }\n}\n"],"mappings":";;;;;;AAeA,OAAOA,oBAAP,MAAiC,0BAAjC;AACA,SAAQC,eAAR,QAA8B,UAA9B;AACA,SAAQC,QAAR,QAAuB,YAAvB;AAEA,eAAe,MAAMC,yBAAN,SAAwCH,oBAAxC,CAA6D;EAC1EI,WAAW,CAACC,KAAD,EAAQ;IACjB,sCACKA,KADL;MAEEC,QAAQ,EAAEJ,QAAQ,CAACK;IAFrB;IAKA,KAAKC,KAAL;IAEA,KAAKC,QAAL,GAAgB,EAAhB;EACD;;EAEDC,UAAU,CAACC,SAAD,EAAY;IACpB,KAAKC,GAAL,GAAWD,SAAX;IACA,OAAO,IAAP;EACD;;EAEDE,MAAM,GAAG;IACP,IAAIC,MAAM,GAAG,KAAKL,QAAL,CAAc,KAAKM,SAAnB,CAAb;;IACA,IAAI,CAACD,MAAL,EAAa;MACXA,MAAM,GAAG;QACPE,UAAU,EAAE,EADL;QAEPC,UAAU,EAAE;MAFL,CAAT;MAIA,KAAKR,QAAL,CAAc,KAAKM,SAAnB,IAAgCD,MAAhC;IACD;;IAED,MAAMI,SAAS,GAAG,KAAKC,gBAAL,EAAlB;;IAEA,MAAM;MAACH,UAAD;MAAaC;IAAb,IAA2BH,MAAjC;IAIA,MAAMM,MAAM,GAAG,EAAf;IACAA,MAAM,WAAI,KAAKC,KAAT,OAAN,GAA2B,CAACH,SAAD,CAA3B;IAGAjB,eAAe,CAACe,UAAD,EAAaC,UAAb,EAAyB,KAAKL,GAA9B,YAAsC,KAAKS,KAA3C,QAAqDH,SAArD,CAAf;IAEA,KAAKV,KAAL;EACD;;EAEDc,OAAO,GAAG;IACR,IAAI,KAAKD,KAAT,EAAgB;MACd,KAAKR,MAAL;IACD;;IAED,IAAIU,MAAM,CAACC,IAAP,CAAY,KAAKf,QAAjB,EAA2BgB,MAA3B,KAAsC,CAA1C,EAA6C;MAC3C,OAAO,IAAP;IACD;;IAED,OAAO,KAAKhB,QAAZ;EACD;;EAEDD,KAAK,GAAG;IACN,MAAMA,KAAN;EACD;;AAxDyE"}