{"version":3,"file":"xviz-validator.js","names":["PRIMITIVE_STYLE_MAP","XVIZValidator","constructor","validateError","validateWarn","_validateWarn","_validateError","warn","msg","error","hasProp","builder","prop","streamId","getStreamId","propSetOnce","Array","length","matchMetadata","metadata","getMetadata","category","getCategory","streams","streamMetadata","validateStyle","properties","Object","keys","_style","validProperties","_type","invalidProps","filter","includes","join"],"sources":["../../../src/builders/xviz-validator.js"],"sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {PRIMITIVE_STYLE_MAP} from './constant';\n\nexport default class XVIZValidator {\n  constructor({validateError, validateWarn}) {\n    this._validateWarn = validateWarn;\n    this._validateError = validateError;\n  }\n\n  warn(msg) {\n    this._validateWarn(msg);\n  }\n\n  error(msg) {\n    this._validateError(msg);\n  }\n\n  hasProp(builder, prop, msg) {\n    if (builder[prop]) {\n      return;\n    }\n\n    const streamId = builder.getStreamId();\n    this._validateWarn(msg || `Stream ${streamId}: ${prop} is missing.`);\n  }\n\n  propSetOnce(builder, prop, msg) {\n    if (!builder[prop]) {\n      return;\n    }\n    if (builder[prop] instanceof Array && builder[prop].length === 0) {\n      return;\n    }\n\n    const streamId = builder.getStreamId();\n    this._validateWarn(msg || `Stream ${streamId}: ${prop} has been already set.`);\n  }\n\n  matchMetadata(builder) {\n    const metadata = builder.getMetadata();\n    const streamId = builder.getStreamId();\n    const category = builder.getCategory();\n\n    if (metadata && metadata.streams) {\n      const streamMetadata = metadata.streams[streamId];\n      if (!streamMetadata) {\n        this._validateWarn(`${streamId} is not defined in metadata.`);\n      } else if (category !== streamMetadata.category) {\n        this._validateWarn(\n          `Stream ${streamId} category '${category}' does not match metadata definition (${\n            streamMetadata.category\n          }).`\n        );\n      }\n    }\n  }\n\n  validateStyle(builder) {\n    const properties = Object.keys(builder._style);\n    const validProperties = PRIMITIVE_STYLE_MAP[builder._type];\n    const streamId = builder.getStreamId();\n    if (validProperties) {\n      const invalidProps = properties.filter(prop => !validProperties.includes(prop));\n      if (invalidProps && invalidProps.length > 0) {\n        this.warn(`Invalid style properties ${invalidProps.join(',')} for stream ${streamId}`);\n      }\n    } else {\n      this.warn(\n        this,\n        `Missing style validations for stream ${streamId} with type ${builder._type}`\n      );\n    }\n  }\n}\n"],"mappings":"AAcA,SAAQA,mBAAR,QAAkC,YAAlC;AAEA,eAAe,MAAMC,aAAN,CAAoB;EACjCC,WAAW,OAAgC;IAAA,IAA/B;MAACC,aAAD;MAAgBC;IAAhB,CAA+B;IACzC,KAAKC,aAAL,GAAqBD,YAArB;IACA,KAAKE,cAAL,GAAsBH,aAAtB;EACD;;EAEDI,IAAI,CAACC,GAAD,EAAM;IACR,KAAKH,aAAL,CAAmBG,GAAnB;EACD;;EAEDC,KAAK,CAACD,GAAD,EAAM;IACT,KAAKF,cAAL,CAAoBE,GAApB;EACD;;EAEDE,OAAO,CAACC,OAAD,EAAUC,IAAV,EAAgBJ,GAAhB,EAAqB;IAC1B,IAAIG,OAAO,CAACC,IAAD,CAAX,EAAmB;MACjB;IACD;;IAED,MAAMC,QAAQ,GAAGF,OAAO,CAACG,WAAR,EAAjB;;IACA,KAAKT,aAAL,CAAmBG,GAAG,qBAAcK,QAAd,eAA2BD,IAA3B,iBAAtB;EACD;;EAEDG,WAAW,CAACJ,OAAD,EAAUC,IAAV,EAAgBJ,GAAhB,EAAqB;IAC9B,IAAI,CAACG,OAAO,CAACC,IAAD,CAAZ,EAAoB;MAClB;IACD;;IACD,IAAID,OAAO,CAACC,IAAD,CAAP,YAAyBI,KAAzB,IAAkCL,OAAO,CAACC,IAAD,CAAP,CAAcK,MAAd,KAAyB,CAA/D,EAAkE;MAChE;IACD;;IAED,MAAMJ,QAAQ,GAAGF,OAAO,CAACG,WAAR,EAAjB;;IACA,KAAKT,aAAL,CAAmBG,GAAG,qBAAcK,QAAd,eAA2BD,IAA3B,2BAAtB;EACD;;EAEDM,aAAa,CAACP,OAAD,EAAU;IACrB,MAAMQ,QAAQ,GAAGR,OAAO,CAACS,WAAR,EAAjB;IACA,MAAMP,QAAQ,GAAGF,OAAO,CAACG,WAAR,EAAjB;IACA,MAAMO,QAAQ,GAAGV,OAAO,CAACW,WAAR,EAAjB;;IAEA,IAAIH,QAAQ,IAAIA,QAAQ,CAACI,OAAzB,EAAkC;MAChC,MAAMC,cAAc,GAAGL,QAAQ,CAACI,OAAT,CAAiBV,QAAjB,CAAvB;;MACA,IAAI,CAACW,cAAL,EAAqB;QACnB,KAAKnB,aAAL,WAAsBQ,QAAtB;MACD,CAFD,MAEO,IAAIQ,QAAQ,KAAKG,cAAc,CAACH,QAAhC,EAA0C;QAC/C,KAAKhB,aAAL,kBACYQ,QADZ,wBACkCQ,QADlC,mDAEIG,cAAc,CAACH,QAFnB;MAKD;IACF;EACF;;EAEDI,aAAa,CAACd,OAAD,EAAU;IACrB,MAAMe,UAAU,GAAGC,MAAM,CAACC,IAAP,CAAYjB,OAAO,CAACkB,MAApB,CAAnB;IACA,MAAMC,eAAe,GAAG9B,mBAAmB,CAACW,OAAO,CAACoB,KAAT,CAA3C;IACA,MAAMlB,QAAQ,GAAGF,OAAO,CAACG,WAAR,EAAjB;;IACA,IAAIgB,eAAJ,EAAqB;MACnB,MAAME,YAAY,GAAGN,UAAU,CAACO,MAAX,CAAkBrB,IAAI,IAAI,CAACkB,eAAe,CAACI,QAAhB,CAAyBtB,IAAzB,CAA3B,CAArB;;MACA,IAAIoB,YAAY,IAAIA,YAAY,CAACf,MAAb,GAAsB,CAA1C,EAA6C;QAC3C,KAAKV,IAAL,oCAAsCyB,YAAY,CAACG,IAAb,CAAkB,GAAlB,CAAtC,yBAA2EtB,QAA3E;MACD;IACF,CALD,MAKO;MACL,KAAKN,IAAL,CACE,IADF,iDAE0CM,QAF1C,wBAEgEF,OAAO,CAACoB,KAFxE;IAID;EACF;;AArEgC"}