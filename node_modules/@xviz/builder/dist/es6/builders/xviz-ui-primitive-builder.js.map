{"version":3,"file":"xviz-ui-primitive-builder.js","names":["XVIZBaseBuilder","CATEGORY","PRIMITIVE_TYPES","XVIZTreeTableRowBuilder","constructor","id","values","parent","_parent","_id","_values","_children","child","row","push","getData","obj","column_values","concat","apply","map","XVIZUIPrimitiveBuilder","props","category","UI_PRIMITIVE","reset","_primitives","treetable","columns","_type","_flush","validatePropSetOnce","_columns","_rows","_validate","_flushPrimitives","Object","keys","length","stream","_streamId","fieldName","primitiveArray","_validator","hasProp","nodes","primitives","_formatPrimitives","primitive"],"sources":["../../../src/builders/xviz-ui-primitive-builder.js"],"sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/* eslint-disable camelcase */\nimport XVIZBaseBuilder from './xviz-base-builder';\nimport {CATEGORY, PRIMITIVE_TYPES} from './constant';\n\nclass XVIZTreeTableRowBuilder {\n  constructor(id, values, parent = null) {\n    this._parent = parent;\n    this._id = id;\n    this._values = values;\n    this._children = [];\n  }\n\n  child(id, values) {\n    const row = new XVIZTreeTableRowBuilder(id, values, this._id);\n    this._children.push(row);\n    return row;\n  }\n\n  getData() {\n    const obj = {id: this._id};\n    if (this._values) {\n      obj.column_values = this._values;\n    }\n    if (this._parent !== null) {\n      obj.parent = this._parent;\n    }\n\n    return [].concat.apply([obj], this._children.map(row => row.getData()));\n  }\n}\n\nexport default class XVIZUIPrimitiveBuilder extends XVIZBaseBuilder {\n  constructor(props) {\n    super({\n      ...props,\n      category: CATEGORY.UI_PRIMITIVE\n    });\n\n    this.reset();\n    // primitives: {[streamId]: []}\n    this._primitives = {};\n  }\n\n  treetable(columns) {\n    if (this._type) {\n      this._flush();\n    }\n\n    this.validatePropSetOnce('_columns');\n\n    this._columns = columns;\n    this._type = PRIMITIVE_TYPES.treetable;\n\n    return this;\n  }\n\n  row(id, values) {\n    this.validatePropSetOnce('_id');\n\n    const row = new XVIZTreeTableRowBuilder(id, values);\n    this._rows.push(row);\n    this._type = PRIMITIVE_TYPES.treetable;\n\n    return row;\n  }\n\n  _validate() {\n    super._validate();\n  }\n\n  _flush() {\n    this._validate();\n\n    this._flushPrimitives();\n  }\n\n  getData() {\n    if (this._type) {\n      this._flush();\n    }\n\n    if (Object.keys(this._primitives).length) {\n      return this._primitives;\n    }\n\n    return null;\n  }\n\n  _flushPrimitives() {\n    let stream = this._primitives[this._streamId];\n    if (!stream) {\n      stream = {};\n      this._primitives[this._streamId] = stream;\n    }\n\n    let fieldName;\n    let primitiveArray;\n\n    switch (this._type) {\n      case PRIMITIVE_TYPES.treetable:\n        fieldName = this._type;\n        if (!stream[fieldName]) {\n          // column must be set before adding rows\n          this._validator.hasProp(this, '_columns');\n\n          stream[fieldName] = {\n            columns: this._columns,\n            nodes: []\n          };\n        }\n        primitiveArray = stream[fieldName].nodes;\n        break;\n\n      default:\n    }\n\n    const primitives = this._formatPrimitives();\n    if (primitives) {\n      for (const primitive of primitives) {\n        primitiveArray.push(primitive);\n      }\n    }\n\n    this.reset();\n  }\n\n  _formatPrimitives() {\n    switch (this._type) {\n      case PRIMITIVE_TYPES.treetable:\n        if (this._rows.length > 0) {\n          return [].concat(...this._rows.map(row => row.getData()));\n        }\n        break;\n\n      default:\n    }\n\n    return null;\n  }\n\n  reset() {\n    this._type = null;\n\n    this._columns = null;\n    this._rows = [];\n  }\n}\n"],"mappings":"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"}