{"version":3,"file":"xviz-ui-primitive-builder.js","names":["XVIZTreeTableRowBuilder","id","values","parent","_parent","_id","_values","_children","row","push","obj","column_values","concat","apply","map","getData","XVIZUIPrimitiveBuilder","props","category","CATEGORY","UI_PRIMITIVE","reset","_primitives","columns","_type","_flush","validatePropSetOnce","_columns","PRIMITIVE_TYPES","treetable","_rows","_validate","_flushPrimitives","Object","keys","length","stream","_streamId","fieldName","primitiveArray","_validator","hasProp","nodes","primitives","_formatPrimitives","primitive","XVIZBaseBuilder"],"sources":["../../../src/builders/xviz-ui-primitive-builder.js"],"sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/* eslint-disable camelcase */\nimport XVIZBaseBuilder from './xviz-base-builder';\nimport {CATEGORY, PRIMITIVE_TYPES} from './constant';\n\nclass XVIZTreeTableRowBuilder {\n  constructor(id, values, parent = null) {\n    this._parent = parent;\n    this._id = id;\n    this._values = values;\n    this._children = [];\n  }\n\n  child(id, values) {\n    const row = new XVIZTreeTableRowBuilder(id, values, this._id);\n    this._children.push(row);\n    return row;\n  }\n\n  getData() {\n    const obj = {id: this._id};\n    if (this._values) {\n      obj.column_values = this._values;\n    }\n    if (this._parent !== null) {\n      obj.parent = this._parent;\n    }\n\n    return [].concat.apply([obj], this._children.map(row => row.getData()));\n  }\n}\n\nexport default class XVIZUIPrimitiveBuilder extends XVIZBaseBuilder {\n  constructor(props) {\n    super({\n      ...props,\n      category: CATEGORY.UI_PRIMITIVE\n    });\n\n    this.reset();\n    // primitives: {[streamId]: []}\n    this._primitives = {};\n  }\n\n  treetable(columns) {\n    if (this._type) {\n      this._flush();\n    }\n\n    this.validatePropSetOnce('_columns');\n\n    this._columns = columns;\n    this._type = PRIMITIVE_TYPES.treetable;\n\n    return this;\n  }\n\n  row(id, values) {\n    this.validatePropSetOnce('_id');\n\n    const row = new XVIZTreeTableRowBuilder(id, values);\n    this._rows.push(row);\n    this._type = PRIMITIVE_TYPES.treetable;\n\n    return row;\n  }\n\n  _validate() {\n    super._validate();\n  }\n\n  _flush() {\n    this._validate();\n\n    this._flushPrimitives();\n  }\n\n  getData() {\n    if (this._type) {\n      this._flush();\n    }\n\n    if (Object.keys(this._primitives).length) {\n      return this._primitives;\n    }\n\n    return null;\n  }\n\n  _flushPrimitives() {\n    let stream = this._primitives[this._streamId];\n    if (!stream) {\n      stream = {};\n      this._primitives[this._streamId] = stream;\n    }\n\n    let fieldName;\n    let primitiveArray;\n\n    switch (this._type) {\n      case PRIMITIVE_TYPES.treetable:\n        fieldName = this._type;\n        if (!stream[fieldName]) {\n          // column must be set before adding rows\n          this._validator.hasProp(this, '_columns');\n\n          stream[fieldName] = {\n            columns: this._columns,\n            nodes: []\n          };\n        }\n        primitiveArray = stream[fieldName].nodes;\n        break;\n\n      default:\n    }\n\n    const primitives = this._formatPrimitives();\n    if (primitives) {\n      for (const primitive of primitives) {\n        primitiveArray.push(primitive);\n      }\n    }\n\n    this.reset();\n  }\n\n  _formatPrimitives() {\n    switch (this._type) {\n      case PRIMITIVE_TYPES.treetable:\n        if (this._rows.length > 0) {\n          return [].concat(...this._rows.map(row => row.getData()));\n        }\n        break;\n\n      default:\n    }\n\n    return null;\n  }\n\n  reset() {\n    this._type = null;\n\n    this._columns = null;\n    this._rows = [];\n  }\n}\n"],"mappings":"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"}