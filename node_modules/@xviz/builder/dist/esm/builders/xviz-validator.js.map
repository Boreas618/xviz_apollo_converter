{"version":3,"file":"xviz-validator.js","names":["PRIMITIVE_STYLE_MAP","XVIZValidator","validateError","validateWarn","_validateWarn","_validateError","msg","builder","prop","streamId","getStreamId","Array","length","metadata","getMetadata","category","getCategory","streams","streamMetadata","properties","Object","keys","_style","validProperties","_type","invalidProps","filter","includes","warn","join"],"sources":["../../../src/builders/xviz-validator.js"],"sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {PRIMITIVE_STYLE_MAP} from './constant';\n\nexport default class XVIZValidator {\n  constructor({validateError, validateWarn}) {\n    this._validateWarn = validateWarn;\n    this._validateError = validateError;\n  }\n\n  warn(msg) {\n    this._validateWarn(msg);\n  }\n\n  error(msg) {\n    this._validateError(msg);\n  }\n\n  hasProp(builder, prop, msg) {\n    if (builder[prop]) {\n      return;\n    }\n\n    const streamId = builder.getStreamId();\n    this._validateWarn(msg || `Stream ${streamId}: ${prop} is missing.`);\n  }\n\n  propSetOnce(builder, prop, msg) {\n    if (!builder[prop]) {\n      return;\n    }\n    if (builder[prop] instanceof Array && builder[prop].length === 0) {\n      return;\n    }\n\n    const streamId = builder.getStreamId();\n    this._validateWarn(msg || `Stream ${streamId}: ${prop} has been already set.`);\n  }\n\n  matchMetadata(builder) {\n    const metadata = builder.getMetadata();\n    const streamId = builder.getStreamId();\n    const category = builder.getCategory();\n\n    if (metadata && metadata.streams) {\n      const streamMetadata = metadata.streams[streamId];\n      if (!streamMetadata) {\n        this._validateWarn(`${streamId} is not defined in metadata.`);\n      } else if (category !== streamMetadata.category) {\n        this._validateWarn(\n          `Stream ${streamId} category '${category}' does not match metadata definition (${\n            streamMetadata.category\n          }).`\n        );\n      }\n    }\n  }\n\n  validateStyle(builder) {\n    const properties = Object.keys(builder._style);\n    const validProperties = PRIMITIVE_STYLE_MAP[builder._type];\n    const streamId = builder.getStreamId();\n    if (validProperties) {\n      const invalidProps = properties.filter(prop => !validProperties.includes(prop));\n      if (invalidProps && invalidProps.length > 0) {\n        this.warn(`Invalid style properties ${invalidProps.join(',')} for stream ${streamId}`);\n      }\n    } else {\n      this.warn(\n        this,\n        `Missing style validations for stream ${streamId} with type ${builder._type}`\n      );\n    }\n  }\n}\n"],"mappings":";;AAcA,SAAQA,mBAAR,QAAkC,YAAlC;;IAEqBC,a;EACnB,6BAA2C;IAAA,IAA9BC,aAA8B,QAA9BA,aAA8B;IAAA,IAAfC,YAAe,QAAfA,YAAe;;IAAA;;IACzC,KAAKC,aAAL,GAAqBD,YAArB;IACA,KAAKE,cAAL,GAAsBH,aAAtB;EACD;;;;WAED,cAAKI,GAAL,EAAU;MACR,KAAKF,aAAL,CAAmBE,GAAnB;IACD;;;WAED,eAAMA,GAAN,EAAW;MACT,KAAKD,cAAL,CAAoBC,GAApB;IACD;;;WAED,iBAAQC,OAAR,EAAiBC,IAAjB,EAAuBF,GAAvB,EAA4B;MAC1B,IAAIC,OAAO,CAACC,IAAD,CAAX,EAAmB;QACjB;MACD;;MAED,IAAMC,QAAQ,GAAGF,OAAO,CAACG,WAAR,EAAjB;;MACA,KAAKN,aAAL,CAAmBE,GAAG,qBAAcG,QAAd,eAA2BD,IAA3B,iBAAtB;IACD;;;WAED,qBAAYD,OAAZ,EAAqBC,IAArB,EAA2BF,GAA3B,EAAgC;MAC9B,IAAI,CAACC,OAAO,CAACC,IAAD,CAAZ,EAAoB;QAClB;MACD;;MACD,IAAID,OAAO,CAACC,IAAD,CAAP,YAAyBG,KAAzB,IAAkCJ,OAAO,CAACC,IAAD,CAAP,CAAcI,MAAd,KAAyB,CAA/D,EAAkE;QAChE;MACD;;MAED,IAAMH,QAAQ,GAAGF,OAAO,CAACG,WAAR,EAAjB;;MACA,KAAKN,aAAL,CAAmBE,GAAG,qBAAcG,QAAd,eAA2BD,IAA3B,2BAAtB;IACD;;;WAED,uBAAcD,OAAd,EAAuB;MACrB,IAAMM,QAAQ,GAAGN,OAAO,CAACO,WAAR,EAAjB;MACA,IAAML,QAAQ,GAAGF,OAAO,CAACG,WAAR,EAAjB;MACA,IAAMK,QAAQ,GAAGR,OAAO,CAACS,WAAR,EAAjB;;MAEA,IAAIH,QAAQ,IAAIA,QAAQ,CAACI,OAAzB,EAAkC;QAChC,IAAMC,cAAc,GAAGL,QAAQ,CAACI,OAAT,CAAiBR,QAAjB,CAAvB;;QACA,IAAI,CAACS,cAAL,EAAqB;UACnB,KAAKd,aAAL,WAAsBK,QAAtB;QACD,CAFD,MAEO,IAAIM,QAAQ,KAAKG,cAAc,CAACH,QAAhC,EAA0C;UAC/C,KAAKX,aAAL,kBACYK,QADZ,wBACkCM,QADlC,mDAEIG,cAAc,CAACH,QAFnB;QAKD;MACF;IACF;;;WAED,uBAAcR,OAAd,EAAuB;MACrB,IAAMY,UAAU,GAAGC,MAAM,CAACC,IAAP,CAAYd,OAAO,CAACe,MAApB,CAAnB;MACA,IAAMC,eAAe,GAAGvB,mBAAmB,CAACO,OAAO,CAACiB,KAAT,CAA3C;MACA,IAAMf,QAAQ,GAAGF,OAAO,CAACG,WAAR,EAAjB;;MACA,IAAIa,eAAJ,EAAqB;QACnB,IAAME,YAAY,GAAGN,UAAU,CAACO,MAAX,CAAkB,UAAAlB,IAAI;UAAA,OAAI,CAACe,eAAe,CAACI,QAAhB,CAAyBnB,IAAzB,CAAL;QAAA,CAAtB,CAArB;;QACA,IAAIiB,YAAY,IAAIA,YAAY,CAACb,MAAb,GAAsB,CAA1C,EAA6C;UAC3C,KAAKgB,IAAL,oCAAsCH,YAAY,CAACI,IAAb,CAAkB,GAAlB,CAAtC,yBAA2EpB,QAA3E;QACD;MACF,CALD,MAKO;QACL,KAAKmB,IAAL,CACE,IADF,iDAE0CnB,QAF1C,wBAEgEF,OAAO,CAACiB,KAFxE;MAID;IACF;;;;;;SArEkBvB,a"}