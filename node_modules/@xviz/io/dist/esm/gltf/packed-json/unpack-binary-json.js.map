{"version":3,"file":"unpack-binary-json.js","names":["unpackJsonArrays","json","buffers","options","unpackJsonArraysRecursive","topJson","object","buffer","decodeJSONPointer","Array","isArray","map","element","newObject","key","pointer","parseJSONPointer","field","index","console","error","value","indexOf","slice","matches","match","parseInt"],"sources":["../../../../src/gltf/packed-json/unpack-binary-json.js"],"sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\nexport default function unpackJsonArrays(json, buffers, options = {}) {\n  return unpackJsonArraysRecursive(json, json, buffers, options);\n}\n\n// Recursively unpacks objects, replacing \"JSON pointers\" with typed arrays\nfunction unpackJsonArraysRecursive(json, topJson, buffers, options = {}) {\n  const object = json;\n\n  const buffer = decodeJSONPointer(object, buffers);\n  if (buffer) {\n    return buffer;\n  }\n\n  // Copy array\n  if (Array.isArray(object)) {\n    return object.map(element => unpackJsonArraysRecursive(element, topJson, buffers, options));\n  }\n\n  // Copy object\n  if (object !== null && typeof object === 'object') {\n    const newObject = {};\n    for (const key in object) {\n      newObject[key] = unpackJsonArraysRecursive(object[key], topJson, buffers, options);\n    }\n    return newObject;\n  }\n\n  return object;\n}\n\nfunction decodeJSONPointer(object, buffers) {\n  const pointer = parseJSONPointer(object);\n  if (pointer) {\n    const [field, index] = pointer;\n    const buffer = buffers[field] && buffers[field][index];\n    if (buffer) {\n      return buffer;\n    }\n    console.error(`Invalid JSON pointer ${object}: #/${field}/${index}`); // eslint-disable-line\n  }\n  return null;\n}\n\nfunction parseJSONPointer(value) {\n  if (typeof value === 'string') {\n    // Remove escape character\n    if (value.indexOf('##/') === 0) {\n      return value.slice(1);\n    }\n\n    let matches = value.match(/#\\/([a-z]+)\\/([0-9]+)/);\n    if (matches) {\n      const index = parseInt(matches[2], 10);\n      return [matches[1], index];\n    }\n\n    // Legacy: `$$$i`\n    matches = value.match(/\\$\\$\\$([0-9]+)/);\n    if (matches) {\n      const index = parseInt(matches[1], 10);\n      return ['accessors', index];\n    }\n  }\n\n  return null;\n}\n"],"mappings":";;AAaA,eAAe,SAASA,gBAAT,CAA0BC,IAA1B,EAAgCC,OAAhC,EAAuD;EAAA,IAAdC,OAAc,uEAAJ,EAAI;EACpE,OAAOC,yBAAyB,CAACH,IAAD,EAAOA,IAAP,EAAaC,OAAb,EAAsBC,OAAtB,CAAhC;AACD;;AAGD,SAASC,yBAAT,CAAmCH,IAAnC,EAAyCI,OAAzC,EAAkDH,OAAlD,EAAyE;EAAA,IAAdC,OAAc,uEAAJ,EAAI;EACvE,IAAMG,MAAM,GAAGL,IAAf;EAEA,IAAMM,MAAM,GAAGC,iBAAiB,CAACF,MAAD,EAASJ,OAAT,CAAhC;;EACA,IAAIK,MAAJ,EAAY;IACV,OAAOA,MAAP;EACD;;EAGD,IAAIE,KAAK,CAACC,OAAN,CAAcJ,MAAd,CAAJ,EAA2B;IACzB,OAAOA,MAAM,CAACK,GAAP,CAAW,UAAAC,OAAO;MAAA,OAAIR,yBAAyB,CAACQ,OAAD,EAAUP,OAAV,EAAmBH,OAAnB,EAA4BC,OAA5B,CAA7B;IAAA,CAAlB,CAAP;EACD;;EAGD,IAAIG,MAAM,KAAK,IAAX,IAAmB,QAAOA,MAAP,MAAkB,QAAzC,EAAmD;IACjD,IAAMO,SAAS,GAAG,EAAlB;;IACA,KAAK,IAAMC,GAAX,IAAkBR,MAAlB,EAA0B;MACxBO,SAAS,CAACC,GAAD,CAAT,GAAiBV,yBAAyB,CAACE,MAAM,CAACQ,GAAD,CAAP,EAAcT,OAAd,EAAuBH,OAAvB,EAAgCC,OAAhC,CAA1C;IACD;;IACD,OAAOU,SAAP;EACD;;EAED,OAAOP,MAAP;AACD;;AAED,SAASE,iBAAT,CAA2BF,MAA3B,EAAmCJ,OAAnC,EAA4C;EAC1C,IAAMa,OAAO,GAAGC,gBAAgB,CAACV,MAAD,CAAhC;;EACA,IAAIS,OAAJ,EAAa;IACX,8BAAuBA,OAAvB;IAAA,IAAOE,KAAP;IAAA,IAAcC,KAAd;;IACA,IAAMX,MAAM,GAAGL,OAAO,CAACe,KAAD,CAAP,IAAkBf,OAAO,CAACe,KAAD,CAAP,CAAeC,KAAf,CAAjC;;IACA,IAAIX,MAAJ,EAAY;MACV,OAAOA,MAAP;IACD;;IACDY,OAAO,CAACC,KAAR,gCAAsCd,MAAtC,iBAAmDW,KAAnD,cAA4DC,KAA5D;EACD;;EACD,OAAO,IAAP;AACD;;AAED,SAASF,gBAAT,CAA0BK,KAA1B,EAAiC;EAC/B,IAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;IAE7B,IAAIA,KAAK,CAACC,OAAN,CAAc,KAAd,MAAyB,CAA7B,EAAgC;MAC9B,OAAOD,KAAK,CAACE,KAAN,CAAY,CAAZ,CAAP;IACD;;IAED,IAAIC,OAAO,GAAGH,KAAK,CAACI,KAAN,CAAY,uBAAZ,CAAd;;IACA,IAAID,OAAJ,EAAa;MACX,IAAMN,KAAK,GAAGQ,QAAQ,CAACF,OAAO,CAAC,CAAD,CAAR,EAAa,EAAb,CAAtB;MACA,OAAO,CAACA,OAAO,CAAC,CAAD,CAAR,EAAaN,KAAb,CAAP;IACD;;IAGDM,OAAO,GAAGH,KAAK,CAACI,KAAN,CAAY,gBAAZ,CAAV;;IACA,IAAID,OAAJ,EAAa;MACX,IAAMN,MAAK,GAAGQ,QAAQ,CAACF,OAAO,CAAC,CAAD,CAAR,EAAa,EAAb,CAAtB;;MACA,OAAO,CAAC,WAAD,EAAcN,MAAd,CAAP;IACD;EACF;;EAED,OAAO,IAAP;AACD"}